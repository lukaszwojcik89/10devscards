---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <main class="container mx-auto px-4 py-12 min-h-screen">
    <div class="max-w-6xl mx-auto">
      <!-- Welcome message for logged in users -->
      <div id="user-welcome" class="text-center mb-12 hidden">
        <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-8 shadow-lg border border-gray-200/50">
          <h1 id="user-greeting" class="text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-4">
            Witaj ponownie! ðŸ‘‹
          </h1>
          <p class="text-xl text-gray-600 mb-8">Gotowy na kolejnÄ… sesjÄ™ nauki?</p>
          
          <div class="flex gap-4 justify-center flex-wrap">
            <a 
              href="/dashboard" 
              class="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl font-medium"
            >
              PrzejdÅº do Panelu UÅ¼ytkownika
            </a>
            <a 
              href="/decks" 
              class="px-8 py-3 bg-white/80 text-gray-700 rounded-xl hover:bg-white transition-all shadow-md hover:shadow-lg font-medium border border-gray-200"
            >
              Moje talie
            </a>
          </div>
        </div>
      </div>

      <!-- Header for guest users -->
      <header id="guest-header" class="text-center mb-16">
        <div class="mb-8">
          <h1 class="text-6xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent mb-6">
            ðŸ§  AI Flashcards
          </h1>
          <p class="text-2xl text-gray-600 mb-4">Ucz siÄ™ efektywnie z fiszkami generowanymi przez sztucznÄ… inteligencjÄ™</p>
          <p class="text-lg text-gray-500 max-w-2xl mx-auto">
            Wykorzystaj moc AI do tworzenia spersonalizowanych fiszek. Nauka nigdy nie byÅ‚a tak efektywna!
          </p>
        </div>
        
        <!-- Call to action for guests -->
        <div class="flex gap-6 justify-center flex-wrap mb-12">
          <a 
            href="/register" 
            class="px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl font-semibold text-lg"
          >
            Rozpocznij za darmo
          </a>
          <a 
            href="/login" 
            class="px-8 py-4 bg-white/80 text-gray-700 rounded-xl hover:bg-white transition-all shadow-md hover:shadow-lg font-semibold text-lg border border-gray-200"
          >
            Zaloguj siÄ™
          </a>
        </div>
      </header>

      <!-- Features section -->
      <section class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
        <div class="bg-white/70 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-gray-200/50 hover:shadow-xl transition-all">
          <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center mb-4">
            <span class="text-white text-2xl">ðŸš€</span>
          </div>
          <h3 class="text-xl font-semibold text-gray-800 mb-3">Generowanie AI</h3>
          <p class="text-gray-600">Automatycznie twÃ³rz fiszki uÅ¼ywajÄ…c sztucznej inteligencji na dowolny temat.</p>
        </div>
        
        <div class="bg-white/70 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-gray-200/50 hover:shadow-xl transition-all">
          <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center mb-4">
            <span class="text-white text-2xl">ðŸ“Š</span>
          </div>
          <h3 class="text-xl font-semibold text-gray-800 mb-3">Inteligentne powtÃ³rki</h3>
          <p class="text-gray-600">System spaced repetition optymalizuje czas nauki i zwiÄ™ksza efektywnoÅ›Ä‡.</p>
        </div>
        
        <div class="bg-white/70 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-gray-200/50 hover:shadow-xl transition-all">
          <div class="w-12 h-12 bg-gradient-to-br from-pink-500 to-rose-600 rounded-xl flex items-center justify-center mb-4">
            <span class="text-white text-2xl">ðŸ“ˆ</span>
          </div>
          <h3 class="text-xl font-semibold text-gray-800 mb-3">Åšledzenie postÄ™pÃ³w</h3>
          <p class="text-gray-600">Monitoruj swoje postÄ™py i zobacz jak roÅ›nie Twoja wiedza dzieÅ„ po dniu.</p>
        </div>
      </section>
    </div>
  </main>
</Layout>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const userWelcome = document.getElementById("user-welcome");
    const guestHeader = document.getElementById("guest-header");

    // Function to generate name from email
    function generateNameFromEmail(email) {
      const username = email.split('@')[0];
      // Capitalize first letter and replace dots/underscores with spaces
      return username
        .replace(/[._-]/g, ' ')
        .split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
        .join(' ');
    }

    // Check if user is logged in
    const token = localStorage.getItem("access_token");

    if (token) {
      try {
        const response = await fetch("/api/auth/me", {
          method: "GET",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json",
          },
        });

        if (response.ok) {
          // User is logged in
          const userData = await response.json();
          
          // Generate name from email
          const generatedName = generateNameFromEmail(userData.data.email);
          
          // Update greeting with user's name
          const userGreeting = document.getElementById("user-greeting");
          if (userGreeting) {
            userGreeting.textContent = `Witaj ponownie, ${generatedName}! ðŸ‘‹`;
          }
          
          userWelcome?.classList.remove("hidden");
          guestHeader?.classList.add("hidden");
        } else {
          throw new Error("Token invalid");
        }
      } catch {
        // Token invalid
        localStorage.removeItem("access_token");
        localStorage.removeItem("refresh_token");
        userWelcome?.classList.add("hidden");
        guestHeader?.classList.remove("hidden");
      }
    } else {
      // No token
      userWelcome?.classList.add("hidden");
      guestHeader?.classList.remove("hidden");
    }
  });
</script>
